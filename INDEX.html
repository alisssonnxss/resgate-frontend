<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA DE RESGATE DE C√ìDIGO √öNICO</title>
    <style>
        /* --- ESTILOS GLOBAIS COM VARI√ÅVEIS CSS (ADICIONADAS PARA CORES/TEMA DIN√ÇMICO) --- */
        :root {
            /* Cores Dark Mode (Padr√£o) - Baseado no seu Azul Vibrante */
            --cor-primaria: #00BFFF; /* Azul Claro Vibrante (Cor base para o tema) */
            --cor-secundaria: #008DBC; /* Azul Mais Escuro (Sombra do bot√£o) */
            --cor-fundo: #121212; /* Fundo Escuro S√≥lido */
            --cor-card-fundo: #1E1E1E; /* Card Escuro */
            --cor-texto-principal: #F0F0F0;
            --cor-texto-secundario: #A0A0A0;
            --cor-aviso-erro: #FF5252;
            --cor-verde: #00E676;
            --cor-amarelo-pendente: #FFD700;
            --cor-borda: #333333;
            --cor-input-fundo: #2A2A2A; 
            --cor-hr: #3A3A3A;
            --cor-hover-item: #252525;
            
            /* Vari√°veis de Tema (Definidas pelo JS: Padr√£o √© Azul do seu design) */
            --cor-tema-primaria: var(--cor-primaria);
            --cor-tema-secundaria: var(--cor-secundaria);
            
            --cor-btn-principal: var(--cor-tema-primaria); /* Agora usa a vari√°vel de tema */
            --cor-btn-reabrir: var(--cor-verde);
            --cor-btn-deletar: #D50000;
            --cor-btn-testar: #FFA500; /* Laranja para Teste */
            --cor-btn-enviado: #4CAF50; /* Verde para novo status */
            
            --border-radius-main: 12px;
            --border-radius-small: 6px;

            /* Cores de Status para Hist√≥rico */
            --status-pendente-cor: var(--cor-amarelo-pendente);
            --status-enviado-cor: var(--cor-btn-enviado); 
            --status-antigo-cor: var(--cor-tema-primaria); /* Agora usa a vari√°vel de tema */
            
            /* Nova Cor para Bot√£o de Suporte/WhatsApp */
            --cor-btn-whatsapp: #25D366; 
            
            /* Estilos para o switch de tema */
            --switch-bg-off: #777;
            --switch-bg-on: var(--cor-tema-primaria);
            --switch-circle: #fff;
        }

        body.light-mode {
            /* Cores Light Mode */
            --cor-fundo: #F0F2F5; 
            --cor-card-fundo: #FFFFFF; 
            --cor-texto-principal: #333333; 
            --cor-texto-secundario: #666666;
            --cor-aviso-erro: #D32F2F; 
            --cor-verde: #388E3C; 
            --cor-amarelo-pendente: #FFC107;
            --cor-borda: #DDDDDD;
            --cor-input-fundo: #F8F8F8; 
            --cor-hr: #EEEEEE;
            --cor-hover-item: #F5F5F5;
            
            --cor-btn-deletar: #D32F2F;
            --cor-btn-testar: #FF8C00; 
            --cor-btn-enviado: #4CAF50;

            /* Cores de Status para Hist√≥rico Light */
            --status-pendente-cor: #FFB300;
            --status-enviado-cor: #4CAF50;
            
            /* Nova Cor para Bot√£o de Suporte/WhatsApp Light */
            --cor-btn-whatsapp: #4CAF50; 
            
            /* Estilos para o switch de tema Light Mode */
            --switch-bg-off: #999;
            --switch-bg-on: var(--cor-tema-primaria);
            --switch-circle: #fff;
        }
        
        /* Ajustes para a cor do tema ser din√¢mica */
        .login-box button {
            background-color: var(--cor-tema-primaria); 
            box-shadow: 0 5px 20px var(--cor-tema-secundaria); 
        }
        .login-box button:hover {
            background-color: var(--cor-tema-secundaria);
            box-shadow: 0 8px 25px var(--cor-tema-secundaria);
        }
        .login-box h2 {
            color: var(--cor-tema-primaria);
        }
        .header-content {
            border-bottom: 3px solid var(--cor-tema-primaria);
        }
        .container button:not(.delete-button, .status-button, .mark-sent-button) {
            background-color: var(--cor-btn-principal);
            box-shadow: 0 4px 15px var(--cor-tema-secundaria);
        }
        .container button:hover:not(.delete-button, .status-button, .mark-sent-button) {
            background-color: var(--cor-tema-secundaria);
            box-shadow: 0 6px 18px var(--cor-tema-secundaria);
        }
        .sidebar-item.active {
             color: var(--cor-tema-primaria);
             /* Linha de destaque para o item ativo */
             border-left: 5px solid var(--cor-tema-primaria); 
             background-color: var(--cor-hover-item); 
        }
        #menu-toggle-btn-wrapper:hover #menu-toggle-btn {
             color: var(--cor-tema-primaria);
             border-color: var(--cor-tema-primaria);
        }
        .guide-container h3 {
             color: var(--cor-tema-primaria);
        }
        /* REMOVENDO A BORDA LATERAL AZUL DO SEU CSS ANTERIOR */
        .sidebar {
            border-right: none; 
        }
        .historico-item-wrapper[data-type="ANTIGO"] {
            border-left: 4px solid var(--cor-tema-primaria);
        }
        .historico-item-wrapper[data-type="ANTIGO"] .status-tag {
            background-color: var(--cor-tema-primaria);
            color: white;
        }
        .item-nome {
            color: var(--cor-tema-primaria);
        }

        /* --- Estilos para a nova aba CONFIGURA√á√ïES --- */
        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        .color-swatch {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transition: border-color 0.2s, transform 0.1s;
        }
        .color-swatch:hover {
            transform: scale(1.1);
        }
        .color-swatch.active {
            border-color: var(--cor-texto-principal);
            transform: scale(1.15);
            box-shadow: 0 0 10px var(--cor-tema-primaria);
        }
        
        /* Cores para o seletor */
        .swatch-azul { background-color: #00BFFF; }
        .swatch-verde { background-color: #00E676; }
        .swatch-vermelho { background-color: #FF5252; }
        .swatch-laranja { background-color: #FFA500; }
        .swatch-roxo { background-color: #9C27B0; }
        .swatch-ciano { background-color: #00BCD4; }
        .swatch-rosa { background-color: #E91E63; }
        .swatch-amarelo { background-color: #FFC107; }
        .swatch-teal { background-color: #009688; }
        .swatch-marrom { background-color: #795548; }
        .swatch-lima { background-color: #CDDC39; }
        .swatch-indigo { background-color: #3F51B5; }

        /* --- Estilos para o Toggle Switch de Tema --- */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--cor-input-fundo);
            padding: 15px;
            border-radius: var(--border-radius-small);
            border: 1px solid var(--cor-borda);
            margin-bottom: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .toggle-label {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--switch-bg-off);
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: var(--switch-circle);
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--switch-bg-on);
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }

        /* --- O RESTANTE DO SEU CSS ORIGINAL (ADICIONANDO O TEXTO 'MENU' NO BOT√ÉO) --- */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            background-color: var(--cor-fundo);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 10px;
            color: var(--cor-texto-principal);
            transition: background-color 0.2s, color 0.2s;
            overflow-x: hidden;
            /* Se o background-image for definido pelo JS, ele ser√° aplicado aqui */
        }
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--cor-fundo); 
            z-index: 10000; 
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.5s, visibility 0.5s;
        }
        .login-box {
            background-color: var(--cor-card-fundo);
            padding: 30px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            max-width: 350px;
            width: 90%;
            text-align: center;
            border: 1px solid var(--cor-borda);
        }
        .login-box h2 {
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        .login-box input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--cor-borda);
            background-color: var(--cor-input-fundo);
            color: var(--cor-texto-principal);
            border-radius: var(--border-radius-small);
            box-sizing: border-box;
            font-size: 0.95em;
        }
        .login-box button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            letter-spacing: 0.5px;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            color: white;
        }
        .login-box button:hover {
            transform: translateY(-3px); 
        }

        /* ----------------------------------- */
        /* BOT√ïES DE TOPO (MENU E SUPORTE) */
        /* ----------------------------------- */
        .top-button {
            position: fixed;
            top: 20px;
            right: 20px; 
            z-index: 1000;
            padding: 10px 15px;
            border-radius: var(--border-radius-main);
            font-size: 0.9em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .top-support-btn {
            background-color: var(--cor-btn-whatsapp);
            color: white;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.5);
            text-decoration: none; 
        }
        .top-support-btn:hover {
            background-color: #128C7E;
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.7);
            transform: translateY(-2px);
        }
        body:not(.logged-in) .top-button {
            display: none; 
        }
        #msgLogin {
            color: var(--cor-aviso-erro);
            font-weight: bold;
            margin-top: 10px;
            display: none;
        }
        .content-hidden {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s;
        }
        body.logged-in .content-hidden {
            opacity: 1;
            visibility: visible;
        }

        /* --- BOT√ÉO DE ABRIR MENU (COM TEXTO 'MENU') --- */
        #menu-toggle-btn-wrapper {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        #menu-toggle-btn-wrapper:hover {
            opacity: 0.8;
        }
        #menu-toggle-btn {
            font-size: 24px;
            color: var(--cor-texto-principal);
            background: var(--cor-card-fundo);
            border: 1px solid var(--cor-borda);
            padding: 5px 10px;
            border-radius: var(--border-radius-small);
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #menu-text {
            color: var(--cor-texto-principal);
            font-weight: bold;
            font-size: 1.1em;
            letter-spacing: 0.5px;
        }
        body:not(.logged-in) #menu-toggle-btn-wrapper {
             display: none;
        }
        
        /* --- SIDEBAR --- (ESTILIZA√á√ÉO MELHORADA) */
        .sidebar {
            height: 100%;
            width: 0; 
            position: fixed;
            z-index: 9999; 
            top: 0;
            left: 0;
            background-color: var(--cor-card-fundo);
            overflow-x: hidden;
            transition: 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            padding-top: 60px;
            box-shadow: 4px 0 20px rgba(0,0,0,0.6);
            display: flex; 
            flex-direction: column;
        }
        .sidebar-nav-main {
            flex-grow: 1; 
        }
        .sidebar-item {
            padding: 15px 25px;
            text-decoration: none;
            font-size: 1.1em;
            color: var(--cor-texto-principal);
            display: flex; 
            align-items: center;
            gap: 10px;
            transition: 0.2s background-color, 0.2s color, 0.2s padding-left;
            cursor: pointer;
            font-weight: 600;
            border-bottom: none; /* REMOVIDA A LINHA INFERIOR */
        }
        .sidebar-item:hover {
            background-color: var(--cor-hover-item);
            padding-left: 30px; 
            color: var(--cor-tema-primaria); /* Destaque no hover */
        }
        .sidebar .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
            text-decoration: none;
            color: var(--cor-texto-secundario);
            transition: color 0.15s;
        }
        .sidebar .closebtn:hover {
             color: var(--cor-aviso-erro);
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 998;
            display: none;
        }
        .container {
            background-color: var(--cor-card-fundo); 
            padding: 25px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); 
            width: 100%;
            max-width: 450px;
            border: 1px solid var(--cor-borda);
            position: relative;
            margin-bottom: 30px; 
            transition: background-color 0.2s, box-shadow 0.2s;
            margin-top: 50px;
        }
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
        }
        h1 {
            color: var(--cor-texto-principal);
            text-align: center;
            margin: 0;
            font-size: 1.6em;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-weight: 700;
        }
        .tab-content { display: none; padding-top: 10px; }
        .tab-content.active { display: block; }

        textarea, input[type="text"], input[type="search"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--cor-borda);
            background-color: var(--cor-input-fundo);
            color: var(--cor-texto-principal);
            border-radius: var(--border-radius-small);
            box-sizing: border-box;
            font-size: 0.95em;
            transition: border-color 0.2s, background-color 0.2s, box-shadow 0.2s;
        }
        
        .container button:not(.delete-button, .status-button, .mark-sent-button) {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            letter-spacing: 0.5px;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            color: white;
        }
        .reopen-button {
            background-color: var(--cor-btn-reabrir) !important;
            box-shadow: 0 4px 15px rgba(0, 230, 118, 0.3);
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
        }
        .reopen-button:hover {
            background-color: #00CC66 !important;
            box-shadow: 0 6px 18px rgba(0, 230, 118, 0.4);
            transform: translateY(-2px);
        }
        .test-button { 
            background-color: var(--cor-btn-testar) !important;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.3);
        }
        .test-button:hover {
            background-color: #FF8C00 !important;
            box-shadow: 0 6px 18px rgba(255, 165, 0, 0.4);
            transform: translateY(-2px);
        }
        .mark-sent-button {
             background-color: var(--cor-btn-enviado);
             color: white;
             border: none;
             padding: 8px 12px;
             border-radius: var(--border-radius-small);
             font-size: 0.8em;
             font-weight: bold;
             cursor: pointer;
             margin-top: 10px;
             display: block;
             width: 100%;
             transition: background-color 0.2s;
        }
        .mark-sent-button:hover {
             background-color: #388E3C; 
        }
        .guide-container {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--cor-hr);
        }
        .guide-container h3 {
             font-size: 1.1em;
             margin-bottom: 15px;
        }
        .guide-step {
            background-color: var(--cor-input-fundo);
            padding: 15px;
            border-radius: var(--border-radius-small);
            border: 1px solid var(--cor-borda);
            margin-bottom: 15px;
        }
        .guide-step p {
            font-weight: bold;
            font-size: 1em;
            margin-bottom: 5px;
        }
        .guide-step .error-status {
            font-size: 0.9em;
            font-weight: 700;
            display: inline-block;
            padding: 4px 8px;
            border-radius: var(--border-radius-small);
            margin-top: 8px;
        }
        .guide-step .error-message {
            background-color: var(--cor-card-fundo);
            border: 1px dashed var(--cor-texto-secundario);
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            white-space: pre-wrap;
            word-break: break-all;
            margin-top: 10px;
            color: var(--cor-texto-secundario);
        }
        .status-funcionando {
            color: var(--cor-verde);
            border: 1px solid var(--cor-verde);
            background-color: rgba(0, 230, 118, 0.1);
        }
        .status-vencido {
            color: var(--cor-aviso-erro);
            border: 1px solid var(--cor-aviso-erro);
            background-color: rgba(255, 82, 82, 0.1);
        }
        .historico-lista {
            list-style: none;
            padding: 0;
            margin: 15px 0 30px 0;
            min-height: 50px; 
        }
        .historico-titulo {
            border-bottom: 2px solid var(--cor-hr);
            padding-bottom: 8px;
            margin-top: 20px;
            color: var(--cor-texto-principal);
            font-size: 1.2em;
        }
        .historico-item-wrapper {
            display: flex;
            align-items: center;
            background-color: var(--cor-input-fundo); 
            border-radius: var(--border-radius-small);
            margin-bottom: 10px;
            padding: 8px 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: all 0.2s;
            flex-wrap: wrap; 
        }
        .historico-item-wrapper:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .historico-item-wrapper[data-type="ENVIADO"] { 
            border-left: 4px solid var(--status-enviado-cor);
        }
        .historico-item-wrapper[data-type="ANTECIPAR"] {
            border-left: 4px solid var(--status-pendente-cor);
        }
        .historico-item-wrapper[data-type="GERAR"] { 
            border-left: 4px solid var(--status-enviado-cor);
        }
        .historico-item {
            flex-grow: 1;
            padding: 5px;
            background-color: transparent;
            cursor: pointer; 
        }
        .item-actions {
            display: flex;
            flex-direction: row-reverse; 
            align-items: center;
            justify-content: flex-end; 
            margin-left: 10px;
            flex-shrink: 0;
            gap: 8px;
            width: auto; 
            margin-top: 0;
            border-top: none; 
            padding-top: 0;
        }
        @media (max-width: 400px) {
             .item-actions {
                 width: 100%; 
                 flex-direction: column-reverse; 
                 align-items: stretch; 
                 gap: 5px;
                 margin-top: 8px;
                 border-top: 1px dashed var(--cor-hr);
                 padding-top: 8px;
             }
             .mark-sent-button-compact {
                 width: 100%;
                 margin-right: 0 !important;
             }
             .delete-button {
                 align-self: flex-end;
                 width: auto;
                 height: auto;
                 padding: 5px;
             }
        }
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        .item-nome {
            font-weight: 700;
            font-size: 1.1em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 60%;
        }
        .item-data {
            font-size: 0.75em;
            color: var(--cor-texto-secundario);
            font-style: italic;
        }
        .item-info-row {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: var(--cor-texto-secundario);
            margin-top: 4px;
        }
        .item-info-row strong {
            font-weight: bold;
            color: var(--cor-texto-principal);
        }
        .status-tag {
            font-size: 0.75em;
            font-weight: 600;
            padding: 3px 6px;
            border-radius: 4px;
            color: #121212; 
            margin-left: 10px;
            background-color: var(--cor-borda);
        }
        .historico-item-wrapper[data-type="ENVIADO"] .status-tag {
            background-color: var(--status-enviado-cor);
            color: white; 
        }
        .historico-item-wrapper[data-type="ANTECIPAR"] .status-tag {
            background-color: var(--status-pendente-cor);
        }
        .delete-button {
            background-color: transparent;
            color: var(--cor-btn-deletar);
            border: none;
            width: 30px; 
            height: 30px;
            line-height: 1;
            font-size: 1.2em; 
            font-weight: bold;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.15s; 
            border-radius: 50%;
        }
        .delete-button:hover {
            background-color: rgba(213, 0, 0, 0.1); 
            color: #FF1744; 
            transform: scale(1.1);
        }
        .historico-item-wrapper[data-type="ENVIADO"] .mark-sent-button-compact {
            display: none;
        }
        .mark-sent-button-compact {
             background-color: var(--cor-btn-enviado);
             color: white;
             border: none;
             padding: 6px 10px; 
             border-radius: var(--border-radius-small);
             font-size: 0.75em; 
             font-weight: 600;
             cursor: pointer;
             transition: background-color 0.2s, transform 0.1s;
             flex-shrink: 0;
             white-space: nowrap;
             margin-right: 10px; 
        }
        .mark-sent-button-compact:hover {
             background-color: #388E3C;
             transform: translateY(-1px);
        }

    </style>
</head>
<body>
    
    <a href="javascript:void(0)" target="_blank" class="top-button top-support-btn" title="Fale com nosso Suporte">
        üí¨ Suporte
    </a>

    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h2>ACESSO AO SISTEMA DE RESGATE</h2>
            <p style="color: var(--cor-texto-secundario); margin-bottom: 20px;">Insira o c√≥digo de acesso √∫nico.</p>
            
            <input type="text" id="inputCodigoUnico" placeholder="Digite seu c√≥digo aqui..." autocomplete="off" maxlength="15">

            <button onclick="fazerLogin()">ACESSAR SISTEMA</button>

            <p id="msgLogin">C√≥digo inv√°lido, j√° usado ou expirado.</p>
        </div>
    </div>

    <div id="menu-toggle-btn-wrapper" class="content-hidden" onclick="openSidebar()">
        <button id="menu-toggle-btn">‚ò∞</button>
        <span id="menu-text">Menu</span>
    </div>

    <div class="overlay" onclick="closeSidebar()"></div>

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeSidebar()">&times;</a>
        
        <div class="sidebar-nav-main">
            <a class="sidebar-item" id="nav-gerar" onclick="changeTab('gerar')">üöÄ Iniciar Novo Resgate</a>
            <a class="sidebar-item" id="nav-antecipar" onclick="changeTab('antecipar')">üíæ Salvar Link Pendente</a>
            <a class="sidebar-item" id="nav-resgateAntigo" onclick="changeTab('resgateAntigo')">üîë Resgate Acesso Antigo</a>
            <a class="sidebar-item" id="nav-testar" onclick="changeTab('testar')">üõ†Ô∏è Testar C√≥digo</a> 
            <a class="sidebar-item" id="nav-historico" onclick="changeTab('historico')">üìã Hist√≥rico de Resgates</a>
            
            <a class="sidebar-item" id="nav-configuracoes" onclick="changeTab('configuracoes')">‚öôÔ∏è Configura√ß√µes</a>
        </div>
        
    </div>

    <div class="container content-hidden">
        <div class="header-content">
            <h1>SISTEMA DE RESGATE DE C√ìDIGO √öNICO</h1>
        </div>

        <div id="gerar" class="tab-content active">
            <label for="linkOriginal">Cole o Link de Origem (Ex: help.garena.com?ref=...)</label>
            <textarea id="linkOriginal" placeholder="Cole o link de origem completo aqui..."></textarea>

            <button onclick="gerarLink()">Gerar e Abrir Link (Status: Enviado)</button>

            <hr style="margin: 30px 0; border: 0; border-top: 1px solid var(--cor-hr);">

            <label for="linkResultado">Link de Resgate Gerado:</label>
            <input type="text" id="linkResultado" value="Aguardando..." readonly>

            <button class="reopen-button" onclick="reabrirLink()" id="btnReabrir" disabled style="margin-top: 10px;">
                ‚û°Ô∏è Reabrir Link Atual
            </button>
            
            <p class="aviso" id="avisoErroGerar" style="display:none; color: var(--cor-aviso-erro); margin-top: 10px;">
                üö® Por favor, cole um link v√°lido que contenha '?' (ponto de interroga√ß√£o).
            </p>
        </div>
        
        <div id="antecipar" class="tab-content">
            <label for="linkAntecipar">Cole o Link para Salvar como Pendente:</label>
            <textarea id="linkAntecipar" placeholder="Cole o link completo aqui. Ele ser√° salvo para resgatar depois."></textarea>

            <button onclick="salvarAntecipar()">Salvar como Pendente</button>

            <p class="aviso" id="avisoErroAntecipar" style="display:none; color: var(--cor-aviso-erro); margin-top: 10px;">
                üö® Por favor, cole um link v√°lido que contenha '?' (ponto de interroga√ß√£o).
            </p>
        </div>

        <div id="resgateAntigo" class="tab-content">
            <label for="linkAccessAntigo">Cole o Access Token/URL Inteira (Ex: access_token=...) </label>
            <textarea id="linkAccessAntigo" placeholder="Cole o access token completo ou a URL inteira aqui..."></textarea>

            <button onclick="resgateAntigo()">Resgatar com M√©todo Antigo</button>

            <p class="aviso" id="avisoErroAntigo" style="display:none; color: var(--cor-aviso-erro); margin-top: 10px;">
                üö® Por favor, cole um token v√°lido que contenha 'access_token=' ou '?'.
            </p>
        </div>
        
        <div id="testar" class="tab-content">
            <h3 class="historico-titulo" style="margin-top: 0; border-bottom: 1px solid var(--cor-hr);">Verifica√ß√£o R√°pida de C√≥digo</h3>
            
            <p style="color: var(--cor-texto-secundario); margin-bottom: 20px; text-align: center;">
                Clique no bot√£o abaixo para abrir o link de teste e verificar o status do c√≥digo atrav√©s da mensagem de erro da Garena.
            </p>

            <button class="test-button" onclick="testarCodigo()">
                üîç TESTAR C√ìDIGO
            </button>
            
            <div class="guide-container">
                <h3>üìö Guia R√°pido: Como o C√≥digo est√°?</h3>
                
                <div class="guide-step">
                    <p>STATUS:</p>
                    <span class="error-status status-funcionando">üü¢ C√ìDIGO FUNCIONANDO</span>
                    
                    <p style="margin-top: 10px; font-weight: normal; color: var(--cor-texto-principal);">
                        Quando o c√≥digo **est√° funcionando** (v√°lido, mas em regi√£o errada), a tela de resgate exibir√°:
                    </p>
                    <div class="error-message">
                        ERROR
Failed to redeem
The code can't be used in your region. Please check again or contact the customer service.
                    </div>
                </div>
                
                <div class="guide-step">
                    <p>STATUS:</p>
                    <span class="error-status status-vencido">üî¥ C√ìDIGO VENCIDO OU EXPIRADO</span>
                    
                    <p style="margin-top: 10px; font-weight: normal; color: var(--cor-texto-principal);">
                        Quando o c√≥digo **est√° vencido/resgatado**, a tela de resgate exibir√°:
                    </p>
                    <div class="error-message">
                        ERROR
Failed to redeem
Failed to redeem. This code is invalid or redeemed.
                    </div>
                </div>
            </div>
            
        </div>
        
        <div id="historico" class="tab-content">
            <label for="searchHistorico">Pesquisar no Hist√≥rico (Por ID ou Nome):</label>
            <input type="search" id="searchHistorico" placeholder="Digite um nome ou ID para buscar..." disabled>
            
            <h3 class="historico-titulo">Hist√≥rico de Resgates</h3>

            <ul id="historicoLista" class="historico-lista">
                </ul>
        </div>
        
        <div id="configuracoes" class="tab-content">
            <h3 class="historico-titulo" style="margin-top: 0;">‚öôÔ∏è Configura√ß√µes</h3>
            
            <h3 style="font-size: 1.1em; color: var(--cor-texto-principal); margin-top: 30px; border-bottom: 1px solid var(--cor-hr); padding-bottom: 5px;">üñºÔ∏è Imagem de Fundo do Sistema</h3>
            
            <p style="color: var(--cor-texto-secundario); margin-bottom: 15px;">
                Cole a **URL completa** de uma imagem (JPG, PNG, etc.) para us√°-la como fundo de tela.
            </p>
            
            <input type="text" id="inputBackgroundImageUrl" placeholder="Ex: https://link-da-sua-imagem.com/fundo.jpg" style="margin-bottom: 10px;">
            
            <button onclick="handleApplyBackground()" style="margin-bottom: 10px;">Aplicar Imagem de Fundo</button>
            <button onclick="applyBackgroundImage('')" style="background-color: var(--cor-aviso-erro); box-shadow: none;">Remover Imagem de Fundo</button>
            
            <div class="toggle-container" style="margin-top: 30px;">
                <span class="toggle-label" id="theme-toggle-label">
                    ‚òÄÔ∏è Tema de Visualiza√ß√£o (Modo Claro/Escuro)
                </span>
                <label class="switch">
                    <input type="checkbox" id="theme-switch" onchange="toggleTheme()">
                    <span class="slider"></span>
                </label>
            </div>


            <h3 style="font-size: 1.1em; color: var(--cor-texto-principal); margin-top: 30px; border-bottom: 1px solid var(--cor-hr); padding-bottom: 5px;">Esquema de Cores (12 Op√ß√µes)</h3>
            
            <p style="color: var(--cor-texto-secundario); margin-bottom: 15px;">
                Selecione a cor principal de destaque do sistema (bot√µes, bordas, etc.):
            </p>
            
            <div class="color-palette" id="colorPalette">
                </div>
            

        </div>
        
    </div>
    
    <div class="footer content-hidden">
        Sistema de Resgate de C√≥digo √önico
    </div>

    <script>
        // CR√çTICO: COLOQUE A URL DO SEU BACKEND AQUI AP√ìS O DEPLOY NO RENDER!
        const BACKEND_URL = "https://resgate-api-node.onrender.com"; 

        // ‚ö†Ô∏è N√öMERO PRINCIPAL: SUBSTITUA ESTE N√öMERO PELO SEU TELEFONE DE SUPORTE (COM C√ìDIGO DO PA√çS E DDD)
        const WHATSAPP_NUMBER_MAIN = "553196373580"; 

        // NOVO N√öMERO DE SUPORTE ADICIONAL (ALEAT√ìRIO)
        const WHATSAPP_NUMBER_SECONDARY = "553899112827"; 

        const LINK_BASE_NOVO = "https://reward.ff.garena.com/en?";
        const LINK_BASE_ANTIGO = "https://reward.ff.garena.com/";
        
        // Link de Teste de C√≥digo Fixo (Valor solicitado)
        const LINK_TESTE_FIXO = "https://reward.ff.garena.com/en?access_token=96156fe920a2edda35b7b3e80503b81c19af947d632ef3e498ddf8622bfb8586&game=FF&lang=en&region=EUROPE&account_id=11264235286&nickname=teste80c$";

        const STORAGE_KEY = 'resgateHistory';
        const THEME_KEY = 'siteTheme';
        const COLOR_KEY = 'siteColor'; 
        const TOKEN_KEY = 'sessionTokenUnique'; 
        const BACKGROUND_IMAGE_KEY = 'siteBackgroundImg'; // NOVO: CHAVE PARA IMAGEM DE FUNDO

        // NOVO: ARRAY COM 12 CORES E SUAS VARIA√á√ïES
        const THEME_COLORS = [
            { name: 'azul', primary: '#00BFFF', secondary: '#008DBC' }, // Seu padr√£o
            { name: 'verde', primary: '#00E676', secondary: '#00B359' },
            { name: 'vermelho', primary: '#FF5252', secondary: '#C62828' },
            { name: 'laranja', primary: '#FFA500', secondary: '#D38000' },
            { name: 'roxo', primary: '#9C27B0', secondary: '#7B1FA2' },
            { name: 'ciano', primary: '#00BCD4', secondary: '#00838F' },
            { name: 'rosa', primary: '#E91E63', secondary: '#C2185B' },
            { name: 'amarelo', primary: '#FFC107', secondary: '#FF8F00' },
            { name: 'teal', primary: '#009688', secondary: '#00695C' },
            { name: 'marrom', primary: '#795548', secondary: '#5D4037' },
            { name: 'lima', primary: '#CDDC39', secondary: '#AFB42B' },
            { name: 'indigo', primary: '#3F51B5', secondary: '#303F9F' },
        ];


        // --- FUN√á√ïES DE UTILIDADE ---
        
        function extrairDadosDoLink(url) {
            const params = new URLSearchParams(url.substring(url.indexOf('?') + 1));
            let nickname = params.get('nickname') || 'N/D';
            const account_id = params.get('account_id') || 'N/D';
            
            if (nickname && nickname !== 'N/D') {
                try {
                    nickname = decodeURIComponent(nickname).replace(/\$$/, '').trim(); 
                } catch (e) {
                    console.error("Erro ao decodificar Nickname:", e);
                }
            }
            
            let linkCurto = url.substring(0, url.indexOf('?') + 1);
            const tokenParam = params.get('access_token');
            
            if (tokenParam) {
                linkCurto += 'access_token=' + tokenParam.substring(0, 15) + '...';
            } else {
                 linkCurto = url.substring(0, 45) + '...'; 
            }

            return {
                id: account_id,
                nickname: nickname,
                linkCurto: linkCurto,
                linkCompleto: url
            };
        }

        function getCurrentDateTime() {
            const now = new Date();
            const date = now.toLocaleDateString('pt-BR');
            const time = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            return `${date} - ${time}`;
        }


        // --- FUN√á√ïES DE LOGIN ---
        
        function liberarAcessoTotal() {
            document.body.classList.add('logged-in');
            document.getElementById('loginOverlay').style.display = 'none';
            
            const supportNumbers = [WHATSAPP_NUMBER_MAIN, WHATSAPP_NUMBER_SECONDARY];
            const chosenNumber = supportNumbers[Math.floor(Math.random() * supportNumbers.length)];

            document.querySelectorAll('.top-support-btn').forEach(a => {
                a.href = `https://wa.me/${chosenNumber}?text=Ol√°!%20Preciso%20de%20suporte%20com%20o%20sistema%20de%20resgate.`;
            });

            loadHistory();
            
            // Atualiza o estado inicial do switch e label
            const isLight = localStorage.getItem(THEME_KEY) === 'light';
            const switchElement = document.getElementById('theme-switch');
            if(switchElement) {
                switchElement.checked = isLight;
            }
            updateThemeLabel(isLight);
            
            // Renderiza a paleta de cores ao fazer login
            renderColorPalette(localStorage.getItem(COLOR_KEY) || 'azul'); 
            
            changeTab('gerar'); 
        }

        async function fazerLogin() {
            const input = document.getElementById('inputCodigoUnico');
            const msg = document.getElementById('msgLogin');
            const codigoDigitado = input.value.trim();
            
            msg.style.display = 'none';

            if (!codigoDigitado) {
                msg.innerText = "‚ùå Digite o c√≥digo de acesso.";
                msg.style.display = 'block';
                return;
            }

            try {
                // Simula√ß√£o de login (Substitua por fetch real com seu backend)
                /*
                const response = await fetch(`${BACKEND_URL}/api/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: codigoDigitado })
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem(TOKEN_KEY, data.sessionToken); 
                    liberarAcessoTotal();
                } else {
                    msg.innerText = data.message || 'Erro de login. Tente novamente.';
                    msg.style.display = 'block';
                }
                */
                // REMOVA O BLOCO ABAIXO E DESCOMENTE O ACIMA QUANDO TIVER SEU BACKEND
                if (codigoDigitado === "SEUTOKEN") {
                    localStorage.setItem(TOKEN_KEY, "fake_session_token"); 
                    liberarAcessoTotal();
                } else {
                    msg.innerText = '‚ùå C√≥digo de acesso inv√°lido.';
                    msg.style.display = 'block';
                }
                // FIM DO BLOCO DE SIMULA√á√ÉO
                
            } catch (error) {
                console.error('Erro de conex√£o com o Backend:', error);
                msg.innerText = '‚ùå Erro de conex√£o. Servidor indispon√≠vel ou URL errada.';
                msg.style.display = 'block';
            }
        }
        
        function checkLoginStatus() {
            const token = localStorage.getItem(TOKEN_KEY);
            
            if (token) {
                liberarAcessoTotal();
            } else {
                document.getElementById('loginOverlay').style.display = 'flex';
            }
        }

        // --- FUN√á√ïES DE SIDEBAR E NAVEGA√á√ÉO ---
        function openSidebar() {
            document.getElementById("mySidebar").style.width = "250px";
            document.querySelector(".overlay").style.display = "block";
            document.body.classList.add('sidebar-open'); 
        }

        function closeSidebar() {
            document.getElementById("mySidebar").style.width = "0";
            document.querySelector(".overlay").style.display = "none";
            document.body.classList.remove('sidebar-open'); 
        }
        
        function changeTab(tabName) {
            closeSidebar(); 
            
            let tabcontent = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            document.getElementById(tabName).classList.add("active");
            
            document.querySelectorAll('.sidebar-nav-main .sidebar-item').forEach(item => {
                 item.classList.remove('active');
            });
            
            const navItem = document.getElementById(`nav-${tabName}`);
            if (navItem) {
                navItem.classList.add('active');
            }

            if (tabName === 'historico') {
                renderHistory(); 
            }
             if (tabName === 'configuracoes') {
                 // Garante que a paleta de cores seja renderizada/atualizada ao entrar na aba
                 const savedColor = localStorage.getItem(COLOR_KEY) || 'azul';
                 renderColorPalette(savedColor);
            }
        }
        
        // --- FUN√á√ïES DE TEMA E CORES (NOVAS) ---
        
        function applyColor(colorName) {
            const root = document.documentElement;
            const color = THEME_COLORS.find(c => c.name === colorName) || THEME_COLORS[0];

            root.style.setProperty('--cor-tema-primaria', color.primary);
            root.style.setProperty('--cor-tema-secundaria', color.secondary);
            localStorage.setItem(COLOR_KEY, color.name);
            
            const loginButton = document.querySelector('.login-box button');
            if(loginButton) {
                 loginButton.style.boxShadow = `0 5px 20px ${color.secondary}`;
            }
        }
        
        function renderColorPalette(activeColorName) {
            const palette = document.getElementById('colorPalette');
            if (!palette) return;

            palette.innerHTML = '';
            
            THEME_COLORS.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = `color-swatch swatch-${color.name}`;
                swatch.style.backgroundColor = color.primary;
                swatch.setAttribute('data-color', color.name);
                
                if (color.name === activeColorName) {
                    swatch.classList.add('active');
                }

                swatch.onclick = () => {
                    applyColor(color.name);
                    document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                    swatch.classList.add('active');
                };
                
                palette.appendChild(swatch);
            });
        }
        
        function updateThemeLabel(isLight) {
            const toggleLabel = document.getElementById('theme-toggle-label');
            if (toggleLabel) {
                 toggleLabel.innerHTML = isLight ? '‚òÄÔ∏è Tema de Visualiza√ß√£o (Modo Claro)' : 'üåô Tema de Visualiza√ß√£o (Modo Escuro)';
            }
        }
        
        function applyTheme(isLight) {
            const body = document.body;
            
            if (isLight) {
                body.classList.add('light-mode');
                localStorage.setItem(THEME_KEY, 'light');
            } else {
                body.classList.remove('light-mode');
                localStorage.setItem(THEME_KEY, 'dark');
            }
            updateThemeLabel(isLight);
        }
        
        function toggleTheme() {
            const switchElement = document.getElementById('theme-switch');
            // Obt√©m o novo estado do switch
            const isLight = switchElement.checked; 
            
            applyTheme(isLight);
        }
        
        // --- FUN√á√ïES DE BACKGROUND (NOVA) ---
        function applyBackgroundImage(imageUrl) {
            const body = document.body;
            
            if (!imageUrl || imageUrl.trim() === '') {
                body.style.backgroundImage = 'none';
                body.style.backgroundSize = 'auto'; // Reset
                body.style.backgroundAttachment = 'scroll'; // Reset
                body.style.backgroundPosition = 'top left'; // Reset
                localStorage.removeItem(BACKGROUND_IMAGE_KEY);
                // Atualiza o input para ficar vazio
                document.getElementById('inputBackgroundImageUrl').value = ''; 
                return;
            }

            // Aplica estilos
            body.style.backgroundImage = `url('${imageUrl}')`;
            body.style.backgroundSize = 'cover';
            body.style.backgroundAttachment = 'fixed';
            body.style.backgroundPosition = 'center center';
            
            // Salva no local storage
            localStorage.setItem(BACKGROUND_IMAGE_KEY, imageUrl);
        }
        
        function handleApplyBackground() {
            const imageUrlInput = document.getElementById('inputBackgroundImageUrl');
            const imageUrl = imageUrlInput.value.trim();
            
            if (!imageUrl.toLowerCase().startsWith('http')) {
                 alert("URL de imagem inv√°lida. Por favor, cole um link direto para a imagem (come√ßando com http:// ou https://).");
                 return;
            }

            applyBackgroundImage(imageUrl);
            alert("Imagem de fundo aplicada! Ela ser√° carregada automaticamente nas pr√≥ximas visitas.");
            closeSidebar();
        }
        
        function loadTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY) || 'dark';
            const savedColor = localStorage.getItem(COLOR_KEY) || 'azul'; 
            const savedBackground = localStorage.getItem(BACKGROUND_IMAGE_KEY); // NOVO
            
            const isLight = savedTheme === 'light';
            
            // Aplica o tema imediatamente
            applyTheme(isLight); 
            
            // Garante que o switch seja inicializado no estado correto
            const switchElement = document.getElementById('theme-switch');
            if(switchElement) {
                switchElement.checked = isLight;
            }
            
            applyColor(savedColor);
            
            // Aplica o background se houver um salvo // NOVO
            if(savedBackground) {
                applyBackgroundImage(savedBackground);
            }
        }
        
        // --- FUN√á√ïES DE HIST√ìRICO ---
        function getHistory() {
            const historyJson = localStorage.getItem(STORAGE_KEY);
            return historyJson ? JSON.parse(historyJson) : [];
        }

        function saveHistory(item) {
            const history = getHistory();
            history.unshift(item); 
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
            renderHistory();
        }
        
        function markAsSent(originalIndex) {
            const history = getHistory();
            
            if (history[originalIndex].type === 'ANTECIPAR') {
                 history[originalIndex].type = 'ENVIADO';
                 localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
                 renderHistory();
            }
        }

        function deleteHistoryItem(index) {
            if (confirm("Tem certeza que deseja apagar este item do hist√≥rico?")) {
                const history = getHistory();
                history.splice(index, 1);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
                renderHistory();
            }
        }

        function renderHistory() {
            const list = document.getElementById('historicoLista');
            const history = getHistory();
            const searchTerm = document.getElementById('searchHistorico').value.toLowerCase().trim();
            
            list.innerHTML = ''; 
            
            const filteredHistory = history.filter(item => {
                if (!searchTerm) return true;
                
                const nickname = item.nickname.toLowerCase();
                const id = item.id.toLowerCase();
                
                return nickname.includes(searchTerm) || id.includes(searchTerm);
            });
            
            if (filteredHistory.length === 0) {
                list.innerHTML = `<p style="color: var(--cor-texto-secundario); text-align: center; margin-top: 30px;">
                    Nenhum resgate encontrado com o termo de pesquisa atual.
                </p>`;
                return;
            }

            filteredHistory.forEach((item, index) => {
                const originalIndex = history.findIndex(h => h.linkCompleto === item.linkCompleto && h.date === item.date);
                
                const li = document.createElement('li');
                li.className = 'historico-item-wrapper';
                
                let currentType = item.type;
                if (currentType === 'GERAR') {
                    currentType = 'ENVIADO'; 
                }
                
                li.setAttribute('data-type', currentType);
                
                const typeText = currentType === 'ENVIADO' ? 'Enviado' : (currentType === 'ANTECIPAR' ? 'Pendente' : 'Antigo');

                const infoDiv = document.createElement('div');
                infoDiv.className = 'historico-item';
                infoDiv.onclick = () => {
                    window.open(item.linkCompleto, '_blank');
                };
                
                infoDiv.innerHTML = `
                    <div class="item-header">
                        <span class="item-nome" title="${item.nickname}">${item.nickname}</span>
                        <span class="status-tag">${typeText}</span>
                    </div>
                    <div class="item-info-row">
                        <span>ID: <strong>${item.id}</strong></span>
                        <span>Data: ${item.date}</span>
                    </div>
                `;
                li.appendChild(infoDiv);
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'item-actions';
                
                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-button';
                deleteButton.title = 'Apagar Item';
                deleteButton.innerHTML = '&times;';
                deleteButton.onclick = (e) => {
                    e.stopPropagation(); 
                    deleteHistoryItem(originalIndex);
                };
                actionsDiv.appendChild(deleteButton);
                
                if (currentType === 'ANTECIPAR') {
                    const markSentButton = document.createElement('button');
                    markSentButton.className = 'mark-sent-button-compact';
                    markSentButton.innerText = 'Enviado';
                    markSentButton.onclick = (e) => {
                        e.stopPropagation();
                        markAsSent(originalIndex);
                    };
                    actionsDiv.appendChild(markSentButton);
                }

                
                li.appendChild(actionsDiv);
                list.appendChild(li);
            });
        }

        function loadHistory() {
             const searchInput = document.getElementById('searchHistorico');
             searchInput.removeAttribute('disabled');
             searchInput.addEventListener('input', () => {
                 if (document.getElementById('historico').classList.contains('active')) {
                    renderHistory();
                 }
             });
        }
        
        // --- FUN√á√ïES DE GERA√á√ÉO ---
        function validarLink(link, avisoId, deveConter = '?') {
            const avisoErro = document.getElementById(avisoId);
            const isValid = link.includes(deveConter);
            
            if (!isValid) {
                avisoErro.style.display = 'block';
                return false; 
            }

            avisoErro.style.display = 'none';
            return true;
        }

        function gerarLink() {
            const linkOriginal = document.getElementById('linkOriginal').value.trim();
            const linkResultadoInput = document.getElementById('linkResultado');
            const btnReabrir = document.getElementById('btnReabrir');
            
            btnReabrir.disabled = true;
            linkResultadoInput.value = "Aguardando...";

            if (!validarLink(linkOriginal, 'avisoErroGerar', '?')) return;

            const stringDeConsulta = linkOriginal.substring(linkOriginal.indexOf('?') + 1);
            const novoLink = LINK_BASE_NOVO + stringDeConsulta;
            
            linkResultadoInput.value = novoLink;
            btnReabrir.disabled = false;
            
            const dados = extrairDadosDoLink(novoLink);

            saveHistory({
                linkCompleto: novoLink,
                linkCurto: dados.linkCurto, 
                id: dados.id,
                nickname: dados.nickname,
                date: getCurrentDateTime(),
                type: 'ENVIADO' 
            });

            window.open(novoLink, '_blank');
        }
        
        function salvarAntecipar() {
            const linkAntecipar = document.getElementById('linkAntecipar').value.trim();
            
            if (!validarLink(linkAntecipar, 'avisoErroAntecipar', '?')) return;
            
            const dados = extrairDadosDoLink(linkAntecipar);
            
            saveHistory({
                linkCompleto: linkAntecipar,
                linkCurto: dados.linkCurto,
                id: dados.id,
                nickname: dados.nickname,
                date: getCurrentDateTime(),
                type: 'ANTECIPAR'
            });
            
            alert(`Link de ${dados.nickname} salvo como Pendente no Hist√≥rico!`);
            
            document.getElementById('linkAntecipar').value = ''; 
        }
        
        function reabrirLink() {
            const linkResultado = document.getElementById('linkResultado').value;
            
            if (linkResultado && (linkResultado.startsWith(LINK_BASE_NOVO) || linkResultado.startsWith(LINK_BASE_ANTIGO))) {
                 window.open(linkResultado, '_blank');
            }
        }
        
        function resgateAntigo() {
            const linkAccessAntigo = document.getElementById('linkAccessAntigo').value.trim();
            
            if (!validarLink(linkAccessAntigo, 'avisoErroAntigo', 'access_token=')) return;
            
            let stringDeConsulta;
            if (linkAccessAntigo.includes('?')) {
                stringDeConsulta = linkAccessAntigo.substring(linkAccessAntigo.indexOf('?') + 1);
            } else if (linkAccessAntigo.startsWith('access_token=')) {
                stringDeConsulta = linkAccessAntigo;
            } else {
                document.getElementById('avisoErroAntigo').style.display = 'block';
                return;
            }

            const novoLink = LINK_BASE_ANTIGO + stringDeConsulta;
            
            const dados = extrairDadosDoLink(novoLink);

            saveHistory({
                linkCompleto: novoLink,
                linkCurto: dados.linkCurto,
                id: dados.id,
                nickname: dados.nickname,
                date: getCurrentDateTime(),
                type: 'ANTIGO'
            });

            window.open(novoLink, '_blank');
        }
        
        function testarCodigo() {
            window.open(LINK_TESTE_FIXO, '_blank');
        }


        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            checkLoginStatus(); 
            
            // NOVO: Adiciona o valor do background salvo no input ao carregar
            const savedBackground = localStorage.getItem(BACKGROUND_IMAGE_KEY);
            const bgInput = document.getElementById('inputBackgroundImageUrl');
            if (bgInput && savedBackground) {
                bgInput.value = savedBackground;
            }
        });

    </script>
</body>
</html>