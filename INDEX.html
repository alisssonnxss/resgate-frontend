<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resgate Premium | @ALISSONNXSS</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Rajdhani:wght@500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        :root {
            --primary: #0984e3;
            --secondary: #6c5ce7;
            --accent: #e84393;
            --gold: #f1c40f;
            --bg: #f0f2f5;
            --text: #2d3436;
            --glass: rgba(255, 255, 255, 0.9);
            --border: rgba(9, 132, 227, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: default; }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f0f2f5 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }

        #custom-alert {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8);
            background: white; border: 2px solid var(--primary);
            padding: 30px; border-radius: 20px; z-index: 10000; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); display: none;
            width: 90%; max-width: 400px; transition: 0.3s;
        }
        #custom-alert.active { display: block; transform: translate(-50%, -50%) scale(1); }
        #custom-alert h2 { font-family: 'Syncopate'; font-size: 0.8rem; margin-bottom: 15px; color: var(--primary); }
        .close-alert { background: var(--primary); color: #fff; border: none; padding: 10px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; font-family: 'Syncopate'; font-size: 0.6rem; }

        .music-widget {
            position: fixed; top: 15px; right: 15px; background: white;
            border: 1px solid var(--border); padding: 8px 12px; border-radius: 50px;
            display: flex; align-items: center; gap: 10px; z-index: 1000; width: 280px; overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .music-scroll { white-space: nowrap; overflow: hidden; flex: 1; }
        .music-scroll span {
            display: inline-block; padding-left: 100%;
            font-family: 'Share Tech Mono'; font-size: 0.65rem; color: var(--primary);
            animation: marquee 10s linear infinite;
        }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
        
        .music-controls { display: flex; gap: 10px; align-items: center; }
        .music-btn { background: none; border: none; color: var(--text); cursor: pointer; font-size: 0.9rem; transition: 0.3s; }
        .music-btn:hover { color: var(--primary); }

        .hero-section {
            text-align: center; padding: 40px 20px; background: var(--glass);
            border: 1px solid var(--border); border-radius: 30px; backdrop-filter: blur(10px); 
            margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.03);
        }
        .profile-img { width: 120px; height: 120px; border-radius: 50%; border: 4px solid white; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .tag-alisson { font-family: 'Syncopate', sans-serif; font-size: clamp(1.2rem, 8vw, 2.2rem); background: linear-gradient(90deg, var(--primary), var(--secondary)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; display: inline-block; }
        .sub-title { margin-top: 10px; font-size: 0.9rem; color: var(--text); opacity: 0.7; font-family: 'Share Tech Mono'; letter-spacing: 2px; text-transform: uppercase; }

        /* Frase Carnaval */
        .carnaval-text { margin-top: 8px; font-family: 'Syncopate'; font-size: 0.65rem; color: var(--accent); font-weight: bold; }

        .social-grid { display: flex; justify-content: center; gap: 12px; margin-top: 25px; flex-wrap: wrap; }
        .social-link { display: flex; align-items: center; gap: 8px; padding: 10px 18px; background: white; border: 1px solid var(--border); border-radius: 50px; color: var(--text); text-decoration: none; font-family: 'Rajdhani'; font-weight: bold; font-size: 0.8rem; transition: 0.4s; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .social-link:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); border-color: var(--primary); }

        .redeem-window {
            background: white; border: 1px solid var(--border); border-radius: 25px;
            padding: 40px 20px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.03);
            position: relative;
        }
        .input-hacker {
            width: 100%; max-width: 500px; padding: 15px; background: #f8f9fa;
            border: 1px solid var(--border); border-radius: 12px; color: var(--primary);
            font-family: 'Share Tech Mono'; font-size: 1.1rem; text-align: center; margin-bottom: 10px; outline: none;
        }
        .btn-action {
            width: 100%; max-width: 500px; padding: 18px; border: none; border-radius: 12px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: #fff; font-family: 'Syncopate'; font-size: 0.8rem; cursor: pointer; transition: 0.4s;
        }
        .btn-action:hover { transform: scale(1.02); filter: brightness(1.1); }

        /* Login Footer */
        .login-footer-container { display: flex; justify-content: flex-end; max-width: 500px; margin: 10px auto; }
        .btn-login-small { background: var(--text); color: white; border: none; padding: 8px 15px; border-radius: 5px; font-family: 'Syncopate'; font-size: 0.55rem; cursor: pointer; opacity: 0.7; }

        .history-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-family: 'Share Tech Mono'; font-size: 0.8rem; }
        .history-table td { padding: 12px; border-bottom: 1px solid #f1f1f1; }
        
        .creators-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .creator-card { background: white; border: 1px solid var(--border); border-radius: 20px; padding: 20px; display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit; transition: 0.3s; }
        .creator-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); border-color: var(--primary); }
        .creator-img { width: 65px; height: 65px; border-radius: 50%; border: 2px solid var(--primary); }

        footer { text-align: center; padding: 50px; color: var(--text); font-family: 'Share Tech Mono'; font-size: 0.7rem; opacity: 0.5; }
    </style>
</head>
<body>

<div id="custom-alert">
    <h2 id="alert-title">SISTEMA</h2>
    <p id="alert-msg" style="font-family: 'Share Tech Mono'; margin: 15px 0;"></p>
    <button class="close-alert" onclick="closeAlert()">FECHAR</button>
</div>

<div class="music-widget">
    <i class="fas fa-compact-disc fa-spin" style="color:var(--primary)"></i>
    <div class="music-scroll"><span id="music-display">O CARNAVAL COME√áOU! APERTE O PLAY</span></div>
    <div class="music-controls">
        <button class="music-btn" onclick="toggleM(event)"><i class="fas fa-play" id="m-icon"></i></button>
        <button class="music-btn" onclick="nextM(event)"><i class="fas fa-forward"></i></button>
    </div>
</div>

<div class="container" data-aos="fade-up">
    <header class="hero-section">
        <img src="FOTOS MEMES/f583f84d8b008b3f3bfb287a17ee198e~tplv-tiktokx-cropcenter_1080_1080.jpeg.png" class="profile-img">
        <br><h1 class="tag-alisson">@ALISSONNXSS</h1>
        <p style="font-family:'Share Tech Mono'; font-size: 0.9rem; color: var(--text); opacity: 0.7; letter-spacing: 2px; text-transform: uppercase;">Central de Resgate para Seguidores</p>
        <div class="carnaval-text">üéä O CARNAVAL DO RESGATE CHEGOU! üéä</div>
        
        <div class="social-grid">
            <a href="https://www.instagram.com/alissonnxss/" target="_blank" class="social-link"><i class="fab fa-instagram" style="color:#E1306C"></i> INSTAGRAM</a>
            <a href="https://www.tiktok.com/@alissonnxss" target="_blank" class="social-link"><i class="fab fa-tiktok"></i> TIKTOK</a>
            <a href="https://www.youtube.com/@alissonnxss" target="_blank" class="social-link"><i class="fab fa-youtube" style="color:#FF0000"></i> YOUTUBE</a>
            <a href="https://discord.gg/J8GWtnafub" target="_blank" class="social-link"><i class="fab fa-discord" style="color:#5865F2"></i> DISCORD</a>
        </div>
    </header>

    <section class="redeem-window">
        <div id="redeem-area" style="display:none;">
            <h2 style="font-family: 'Syncopate'; font-size: 0.7rem; color: var(--primary); margin-bottom: 15px;">√ÅREA DE RESGATE</h2>
            <input type="text" id="codeInput" class="input-hacker" placeholder="DIGITE O C√ìDIGO AQUI">
            <button class="btn-action" id="btnVerify" onclick="validar()">RESGATAR AGORA</button>
            <p id="userStatus" style="margin-top:15px; font-family:'Share Tech Mono'; font-size:0.8rem; color:#2ecc71; font-weight:bold;"></p>
            <button onclick="logout()" style="background:none; border:none; color:red; cursor:pointer; font-family:'Syncopate'; font-size:0.5rem; margin-top:10px;">SAIR DA CONTA</button>
        </div>

        <div id="lock-screen">
            <i class="fas fa-lock" style="font-size: 2rem; opacity: 0.1; margin-bottom: 10px;"></i>
            <p style="font-family: 'Share Tech Mono'; opacity: 0.5;">FA√áA LOGIN PARA LIBERAR O RESGATE</p>
        </div>

        <div class="login-footer-container" id="login-trigger-box">
            <button class="btn-login-small" onclick="mostrarLogin()">LOGIN</button>
        </div>

        <div id="login-form" style="display:none; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px;">
            <input type="text" id="loginNick" class="input-hacker" placeholder="SEU NICK">
            <input type="text" id="loginID" class="input-hacker" placeholder="SEU ID">
            <button class="btn-action" style="background: var(--text);" onclick="salvarLogin()">ENTRAR NO SISTEMA</button>
        </div>
    </section>

    <section class="hero-section" style="margin-top: 30px;">
        <h2 style="font-family: 'Syncopate'; font-size: 0.7rem; color: var(--primary);">üìú √öLTIMOS PREMIADOS</h2>
        <table class="history-table"><tbody id="historyBody"></tbody></table>
    </section>

    <div class="creators-container">
        <a href="https://www.tiktok.com/@yellowtv01" target="_blank" class="creator-card">
            <img src="AMARELADO.jpeg" class="creator-img"><div><h4>yellowtv01</h4></div>
        </a>
        <a href="https://www.tiktok.com/@titanffofc" target="_blank" class="creator-card">
            <img src="FOTOS MEMES/titan.jpeg" class="creator-img"><div><h4>titanffofc</h4></div>
        </a>
        <a href="https://www.tiktok.com/@ittaloff7" target="_blank" class="creator-card">
            <img src="FOTOS MEMES/EMERSON.jpeg" class="creator-img"><div><h4>ITTALOFF7</h4></div>
        </a>
        <a href="https://www.tiktok.com/@eduzinssff" target="_blank" class="creator-card">
            <img src="FOTOS MEMES/EDUZIN.jpeg" class="creator-img"><div><h4>EDUZINSSFF</h4></div>
        </a>
    </div>
</div>

<footer>Desenvolvido por @alissonnxss</footer>

<audio id="bgAudio"></audio>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<script>
    AOS.init();
    const audio = document.getElementById('bgAudio');
    const API_URL = "https://resgate-api-node.onrender.com"; 
    
    let userLogged = JSON.parse(localStorage.getItem('user_data')) || null;
    let historyDataGlobal = [];

    const playlist = [
        { name: "S√ì CAPA EM PEAK - @ALISSONNXSS", src: "FOTOS MEMES/S√≥ Capa em Peak (1).mp3" },
        { name: "BARBIE - Mc Tuto", src: "FOTOS MEMES/BARBIE - Mc Tuto.mp3" }
    ];
    let currentM = 0;

    window.onload = () => {
        if(userLogged) liberar();
        loadHistory();
        setInterval(() => {
            confetti({ particleCount: 35, spread: 70, origin: { y: 0.7 }, colors: ['#0984e3', '#6c5ce7', '#e84393'] });
        }, 7000);
    };

    function mostrarLogin() {
        document.getElementById('login-form').style.display = 'block';
        document.getElementById('lock-screen').style.display = 'none';
        document.getElementById('login-trigger-box').style.display = 'none';
    }

    function salvarLogin() {
        const n = document.getElementById('loginNick').value.trim();
        const i = document.getElementById('loginID').value.trim();
        if(!n || !i) return showAlert("AVISO", "PREENCHA NICK E ID.");
        userLogged = { nick: n, id: i };
        localStorage.setItem('user_data', JSON.stringify(userLogged));
        liberar();
    }

    function liberar() {
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('lock-screen').style.display = 'none';
        document.getElementById('login-trigger-box').style.display = 'none';
        document.getElementById('redeem-area').style.display = 'block';
        document.getElementById('userStatus').innerText = `CONECTADO: ${userLogged.nick}`;
    }

    function logout() { localStorage.removeItem('user_data'); location.reload(); }

    function loadMusic(idx) {
        audio.src = playlist[idx].src;
        document.getElementById('music-display').innerText = playlist[idx].name;
    }
    loadMusic(0);

    function toggleM(e) {
        if(audio.paused) { audio.play(); document.getElementById('m-icon').className = "fas fa-pause"; }
        else { audio.pause(); document.getElementById('m-icon').className = "fas fa-play"; }
    }

    function nextM() {
        currentM = (currentM + 1) % playlist.length;
        loadMusic(currentM); audio.play();
    }

    function showAlert(t, m) {
        document.getElementById('alert-title').innerText = t;
        document.getElementById('alert-msg').innerText = m;
        document.getElementById('custom-alert').classList.add('active');
    }
    function closeAlert() { document.getElementById('custom-alert').classList.remove('active'); }

    async function validar() {
        const code = document.getElementById('codeInput').value.trim().toUpperCase();
        if(!code) return showAlert("AVISO", "DIGITE O C√ìDIGO.");

        // VERIFICA SE O C√ìDIGO J√Å FOI USADO (NOVIDADE)
        const usadoPor = historyDataGlobal.find(log => log.code === code);
        if(usadoPor) {
            return showAlert("J√Å RESGATADO", `ESSE C√ìDIGO J√Å FOI USADO POR: ${usadoPor.user.toUpperCase()}`);
        }
        
        const btn = document.getElementById('btnVerify');
        btn.disabled = true; btn.innerText = "VERIFICANDO...";

        const hoje = new Date().toLocaleDateString('pt-BR');
        const jaResgatouHoje = historyDataGlobal.some(log => log.id === userLogged.id && log.data === hoje);
        if(jaResgatouHoje) {
            btn.disabled = false; btn.innerText = "RESGATAR AGORA";
            return showAlert("LIMITE DI√ÅRIO", "Voc√™ j√° resgatou hoje!");
        }

        try {
            const res = await fetch(`${API_URL}/api/validate`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ code }) });
            const data = await res.json();

            if(data.success) {
                await fetch(`${API_URL}/api/register`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ code, name: userLogged.nick, id: userLogged.id }) });
                confetti({ particleCount: 150, spread: 100 });
                
                const hora = new Date().toLocaleTimeString('pt-BR');
                const msg = `üéÅ *RESGATE CARNAVAL* üéÅ\n\nüë§ *NICK:* ${userLogged.nick}\nüÜî *ID:* ${userLogged.id}\n‚ú® *ITEM:* ${data.reward}\nüé´ *C√ìDIGO:* ${code}\nüìÖ *DATA:* ${hoje}\n‚è∞ *HORA:* ${hora}`;
                
                // MENSAGEM CLARA DE REDIRECIONAMENTO (NOVIDADE)
                showAlert("PARAB√âNS!", "C√≥digo v√°lido! Voc√™ ser√° redirecionado ao WhatsApp agora para receber seu pr√™mio.");
                
                setTimeout(() => {
                    window.open(`https://wa.me/553898455679?text=${encodeURIComponent(msg)}`, '_blank');
                    location.reload();
                }, 3000);
            } else {
                showAlert("ERRO", "C√≥digo inv√°lido!");
                btn.disabled = false; btn.innerText = "RESGATAR AGORA";
            }
        } catch(e) { btn.disabled = false; }
    }

    async function loadHistory() {
        try {
            const res = await fetch(`${API_URL}/api/public/history`);
            const data = await res.json();
            historyDataGlobal = data;
            const body = document.getElementById('historyBody');
            body.innerHTML = data.reverse().slice(0, 5).map(log => `
                <tr>
                    <td style="font-weight:bold">${log.user}</td>
                    <td style="color:var(--primary)">${log.reward}</td>
                    <td style="font-size:0.7rem; opacity:0.6">ID: ${log.id}</td>
                </tr>`).join('');
        } catch(e) {}
    }
    setInterval(loadHistory, 8000);
</script>
</body>
</html>